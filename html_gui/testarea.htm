<style>
    #bmp {
        display: table;
        border-spacing: 2px;
        background-color: rgb(194, 193, 193);
        border: 2px;
    }
    
    .center {
        display: flex;
        justify-content: center;
        align-items: center;
    }
    
    .trow {
        display: table-row;
    }
    
    .pixel {
        display: table-cell;
        background-color: black;
        width: 30px;
        height: 30px;
    }
    
    .huebee__cursor {
        width: 25px;
        height: 25px;
    }
</style>
<script>
    connectionStart();
    $("#brightness").change(function() {
        var val = $("#brightness").val();
        $("#brightnessVal").html(val);
        SendTest('brightness', val);
    });
</script>
<div class="col-md-4">
    <h2 class="text-center">JSON</h2>
    <hr>
    <textarea class="form-control" id="json" rows="17" wrap="off" placeholder='{"text":{"textString":"Test It :D","scrollText":"auto","bigFont":false,"centerText":false,"position":{"x":0,"y":1},"color":{"r":255,"g":255,"b":255}}}}'></textarea>
    <br />
    <div class="col-md-12 text-center">
        <button type="button" class="btn btn-outline-primary" onclick="SendTest('json',$('#json').val())"><span
                data-feather="send"></span>
            JSON senden</button>
    </div>
</div>
<div class="col-md-4">
    <h2 class="text-center">Text / Brightness</h2>
    <hr>
    <label for="brightness">Helligkeit:</label>
    <input type="range" class="custom-range" min="0" max="255" id="brightness">
    <div class="text-center" id="brightnessVal">127</div>
    <br />
    <div class="form-group">
        <label for="text">Text:</label>
        <input type="text" class="form-control" id="text" placeholder="Text eingeben...">
    </div>
    <br />
    <div class="form-group">
        <label for="text">ScrollTextDelay:</label>
        <input type="text" class="form-control" id="scrollTextDelayInput" placeholder="" value="100">
    </div>
    <br />
    <div class="col-md-12 text-center">
        <button type="button" class="btn btn-outline-primary" onclick="SendTest('text',$('#text').val())"><span
                data-feather="send"></span>
                Text senden</button>
    </div>
</div>
<div class="col-md-4">
    <h2 class="text-center">Bitmap</h2>
    <hr>
    <textarea class="form-control" id="bitmap" rows="17" wrap="off" placeholder='[ 0,0,0......] or [[ 0,0,0......],[ 0,0,0......],[ 0,0,0......],[ 0,0,0......]]'></textarea>
    <br />
    <div class="col-md-12 text-center">
        <button type="button" class="btn btn-outline-primary" onclick="SendTest('bitmap',$('#bitmap').val())"><span
                data-feather="send"></span>
            Grafik senden</button>
    </div>
</div>
<div class="container">
    <main role="main" class="pb-3">
        <div class="col-md-12">
            <br />
            <div class="card col-md-12 box-shadow">
                <div class="card-body">
                    <p></p>
                    <div>
                        <div>
                            <input class="color-input form-control" value="#08F" onfocus="blur();" />
                        </div>
                    </div>
                    <p></p>
                    <div class="center">
                        <div id="bmp">
                            <div class="trow">
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                            </div>
                            <div class="trow">
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                            </div>
                            <div class="trow">
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                            </div>
                            <div class="trow">
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                            </div>
                            <div class="trow">
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                            </div>
                            <div class="trow">
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                            </div>
                            <div class="trow">
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                            </div>
                            <div class="trow">
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                                <div class="pixel"></div>
                            </div>
                        </div>
                    </div>

                    <p></p>
                    <textarea class="form-control" rows="4" id="output"></textarea>
                    <p></p>
                    <div class="custom-control custom-switch text-center">
                        <input type="checkbox" class="custom-control-input" id="livedraw">
                        <label class="custom-control-label" for="livedraw">LiveDraw aktivieren</label>
                    </div>
                    <p></p>
                    <div class="text-center">
                        <p>
                            <a href="#/" id="btn-clipboard" class="btn btn-outline-success">
                    Kopieren
                </a>
                        </p>
                    </div>
                    <div class="text-center">
                        <p>
                            <a href="#/" id="btn-clear" class="btn btn-outline-danger">Alles löschen</a>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>
<script src="./site.js"></script>
<script src="./huebee.min.js"></script>
<script src="./bootbox.all.min.js"></script>

<script>
    $(function() {

        var penColor = "#08f";
        var output;

        RGB565IntArrayPaint();

        var hueb = new Huebee('.color-input', {
            // options
            notation: 'hex',
            saturations: 3,
        });

        hueb.on('change', function(color, hue, sat, lum) {
            penColor = color;
        })

        $(".pixel").click(function() {
            $(this).css('background-color', penColor);
            output = "";
            $(".pixel").each(function() {
                var array = CreateRGBSplit($(this).css('background-color'))
                var int16 = RGB888ToRGB565(array);
                output += int16 + ",";
            });

            CreateOutput(output);
        });

        $(".pixel").bind("contextmenu", function(e) {
            $(this).css('background-color', "#000000");
            output = "";
            $(".pixel").each(function() {
                var array = CreateRGBSplit($(this).css('background-color'))
                var int16 = RGB888ToRGB565(array);
                output += int16 + ",";
            });
            CreateOutput(output);
            e.preventDefault();
        });

        $("#output").keyup(function() {
            RGB565IntArrayPaint();
        });

        $("#btn-clipboard").click(function() {
            $("textarea").select();
            document.execCommand('copy');
        });

        $("#btn-clear").click(function() {
            $(".pixel").each(function() {
                $(this).css('background-color', "#000000")
                $("#output").val('');
            })
        });

        $("#btn-show").click(function() {
            var bmpData = $("#output").val();

            if (bmpData.includes("],[")) {
                $.ajax({
                    type: "POST",
                    contentType: "text/plain; charset=utf-8",
                    dataType: "json",
                    url: 'http://' + $(location).attr('hostname') + '/api/screen',
                    data: '{"bitmapAnimation":{"data":[' + bmpData + '],"animationDelay": 200}}'
                });
            } else {
                $.ajax({
                    type: "POST",
                    contentType: "text/plain; charset=utf-8",
                    dataType: "json",
                    url: 'http://' + $(location).attr('hostname') + '/api/screen',
                    data: '{"bitmap":{"data":' + bmpData + ',"position":{"x":0,"y":0},"size":{"width":8,"height":8}}}'
                });
            }
        });

        $("#livedraw").change(function() {
            if ($(this).prop('checked')) {
                connection = new WebSocket('ws://' + $(location).attr('hostname') + ':81/setScreen');

                connection.onopen = function() {}

                connection.onerror = function(error) {
                    // Debug
                    console.log('WebSocket Error ' + error);
                    if (connection.readyState !== WebSocket.CLOSED) {
                        connection.close();
                    }
                }
            } else {
                if (connection != null && connection.readyState != WebSocket.CLOSED) {
                    connection.close();
                }
            }

        });

    });
</script>
<script>
    feather.replace()
</script>